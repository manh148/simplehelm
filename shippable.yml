# Language setting
language: node_js

# Version number
node_js:
  - 0.10

env:
  - TEST=true

build:

  cache: true

  pre_ci_boot:
      image_name: drydock/u14nodpls
      image_tag: prod

  ci:
    - echo "$HOME"
    - echo "$USER"
    - sudo docker -v
    - echo "$BRANCH.$SHIPPABLE_BUILD_NUMBER"
    - sudo docker build -t trriplejay/simpleserver:$BRANCH.$SHIPPABLE_BUILD_NUMBER .
    #- sudo docker build -t trriplejay/simpleserver:$BRANCH.$SHIPPABLE_BUILD_NUMBER --build-arg mytag=$BRANCH.$SHIPPABLE_BUILD_NUMBER .
    - sudo docker push trriplejay/simpleserver:$BRANCH.$SHIPPABLE_BUILD_NUMBER

  on_success:
    - echo "yay"

integrations:
  hub:
    - integrationName: "trriplejay docker hub"
      type: docker
      branches:
        only:
          - master
  notifications:
    - integrationName: irc
      type: irc
      recipients:
        - "irc.rizon.net#testshippable"
      branches:
        only:
          - master
      on_success: always
      on_failure: always

  deploy:
    - integrationName: "shippable demo ecs"
      type: aws
      target: eb_docker
      application_name: trriplejayEBTest
      env_name: trriplejayebtest-env
      region: us-west-1
      bucket_name: elasticbeanstalk-us-west-1-412520076220
      image_name: trriplejay/simpleserver
      image_tag: $BRANCH.$SHIPPABLE_BUILD_NUMBER
